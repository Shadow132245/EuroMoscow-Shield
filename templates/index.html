<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EuroMoscow | V26 Cosmic</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/ayu-mirage.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>

    <style>
        :root {
            --bg: #030305;
            --surface: #0a0a0c;
            --surface-2: #141418;
            --border: rgba(255, 255, 255, 0.06);
            --accent: #6366f1; /* Indigo */
            --text: #ffffff;
            --text-dim: #94a3b8;
            --glow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        * { box-sizing: border-box; outline: none; }
        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Inter', sans-serif; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* Cosmic Background */
        .cosmic-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.08), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(168, 85, 247, 0.08), transparent 25%);
        }

        /* Navbar */
        nav {
            height: 70px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: rgba(3,3,5,0.8); backdrop-filter: blur(10px);
        }
        .brand { font-weight: 900; font-size: 22px; letter-spacing: -0.5px; display: flex; align-items: center; gap: 10px; }
        .brand i { color: var(--accent); }
        
        .lang-tabs { display: flex; background: var(--surface); padding: 4px; border-radius: 12px; border: 1px solid var(--border); }
        .tab { 
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-dim); transition: 0.3s;
        }
        .tab:hover { color: #fff; background: rgba(255,255,255,0.02); }
        .tab.active { background: var(--surface-2); color: #fff; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

        /* Main Layout */
        .layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 340px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .sidebar-footer { padding: 20px; border-top: 1px solid var(--border); background: var(--surface-2); }

        /* Switches */
        .mode-switch { display: flex; background: var(--bg); border-radius: 8px; padding: 4px; border: 1px solid var(--border); }
        .switch-btn { flex: 1; padding: 8px; text-align: center; border-radius: 6px; font-size: 12px; font-weight: 700; color: var(--text-dim); cursor: pointer; transition: 0.3s; }
        .switch-btn.active { background: var(--surface-2); color: #fff; border: 1px solid var(--border); }
        
        /* Option Card */
        .opt-card {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; background: var(--bg); border: 1px solid var(--border);
            border-radius: 10px; cursor: pointer; transition: 0.2s;
        }
        .opt-card:hover { border-color: var(--accent); transform: translateX(2px); }
        .opt-label { font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .opt-checkbox { width: 16px; height: 16px; accent-color: var(--accent); cursor: pointer; }

        /* Main Button */
        .btn-primary {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--accent), #4f46e5);
            border: none; border-radius: 10px; color: #fff; font-weight: 700; font-size: 15px;
            cursor: pointer; transition: 0.3s; box-shadow: var(--glow);
        }
        .btn-primary:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(99, 102, 241, 0.5); }

        /* Editor */
        .editor-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        .editor-header {
            height: 40px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; border-bottom: 1px solid var(--border); font-size: 12px;
            background: var(--surface); font-weight: 600; color: var(--text-dim);
        }
        .CodeMirror { flex: 1; font-family: 'Fira Code', monospace; font-size: 14px; background: transparent !important; }
        .cm-s-ayu-mirage.CodeMirror { background: transparent !important; }

        /* TERMINAL (Professional) */
        .term-overlay {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 0;
            background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border); z-index: 200; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .term-overlay.open { height: 400px; }
        .term-header {
            padding: 10px 20px; background: #111; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #888;
        }
        .term-body { flex: 1; padding: 15px; font-family: 'Fira Code', monospace; font-size: 14px; overflow-y: auto; color: #ccc; }
        .term-line { margin-bottom: 4px; }
        .term-input-line { display: flex; align-items: center; gap: 8px; }
        .term-prompt { color: var(--accent); font-weight: bold; }
        .term-in { flex: 1; background: transparent; border: none; color: #fff; font-family: inherit; font-size: inherit; outline: none; }

        /* API DOCS MODAL */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 999; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .modal-card {
            width: 800px; max-height: 90vh; background: var(--surface); border: 1px solid var(--border);
            border-radius: 16px; overflow: hidden; display: flex; flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6); animation: scaleUp 0.3s ease;
        }
        @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-head { padding: 20px 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: 800; font-size: 18px; }
        .modal-body { padding: 30px; overflow-y: auto; }
        .api-method { display: inline-block; padding: 4px 8px; background: var(--accent); color: #fff; border-radius: 4px; font-size: 12px; font-weight: bold; margin-right: 10px; }
        pre { background: #000; padding: 15px; border-radius: 8px; border: 1px solid var(--border); color: #a5b3ce; overflow-x: auto; font-family: 'Fira Code'; font-size: 13px; }

        /* Shortcuts Hint */
        .shortcuts { position: fixed; bottom: 10px; left: 10px; font-size: 10px; color: #444; font-family: 'Inter'; pointer-events: none; }

        @media (max-width: 900px) { .layout { flex-direction: column; } .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); order: 2; } .editor-area { height: 500px; order: 1; } .tabs-container { display: none; } }
    </style>
</head>
<body>

    <div class="cosmic-bg"></div>

    <nav>
        <div class="brand"><i class="fas fa-shield-halved"></i> EuroMoscow <small>V26</small></div>
        <div class="tabs-container">
            <div class="tab active" onclick="setLang('python', '#6366f1')">Python</div>
            <div class="tab" onclick="setLang('javascript', '#eab308')">JavaScript</div>
            <div class="tab" onclick="setLang('lua', '#22c55e')">Lua</div>
            <div class="tab" onclick="setLang('php', '#8b5cf6')">PHP</div>
            <div class="tab" onclick="setLang('html', '#f97316')">HTML</div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="tab" onclick="toggleTerminal()"><i class="fas fa-terminal"></i> Term</button>
            <button class="tab" onclick="toggleModal('api')"><i class="fas fa-book"></i> API</button>
        </div>
    </nav>

    <div class="layout">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="mode-switch">
                    <div class="switch-btn active" onclick="setMode('encrypt')">ENCRYPT</div>
                    <div class="switch-btn" onclick="setMode('decrypt')">DECRYPT</div>
                </div>
            </div>

            <div class="sidebar-content">
                <div id="enc-opts">
                    <div style="font-size:11px; font-weight:700; color:var(--text-dim); margin-bottom:10px; text-transform:uppercase;">Protection Layers</div>
                    <div id="dynamic-opts">
                        </div>

                    <div style="font-size:11px; font-weight:700; color:var(--text-dim); margin:20px 0 10px 0; text-transform:uppercase;">File Actions</div>
                    <div class="opt-card" onclick="document.getElementById('file').click()">
                        <span class="opt-label"><i class="fas fa-file-upload"></i> Upload File</span>
                    </div>
                    <div class="opt-card" onclick="document.getElementById('zip').click()" style="margin-top:8px;">
                        <span class="opt-label"><i class="fas fa-file-zipper"></i> Upload Project (ZIP)</span>
                    </div>
                    <input type="file" id="file" style="display:none">
                    <input type="file" id="zip" style="display:none" accept=".zip">
                </div>
                
                <div id="dec-opts" style="display: none; text-align: center; padding: 20px; color: var(--text-dim);">
                    <i class="fas fa-wand-magic-sparkles" style="font-size: 40px; margin-bottom: 15px; color: var(--accent);"></i>
                    <p>Smart Decryptor Active.<br>Paste encrypted code and let the system handle it.</p>
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="btn-primary" id="actionBtn" onclick="process()">PROTECT CODE (Ctrl+Enter)</button>
            </div>
        </div>

        <div class="editor-area">
            <div class="editor-header">
                <span>SOURCE CODE</span>
                <div style="display: flex; gap: 15px;">
                    <i class="fas fa-eraser" onclick="editor.setValue('')" style="cursor: pointer; color: #666;"></i>
                    <i class="fas fa-copy" onclick="copy()" style="cursor: pointer; color: #666;"></i>
                    <i class="fas fa-download" onclick="download()" style="cursor: pointer; color: var(--accent);"></i>
                </div>
            </div>
            <textarea id="editor"></textarea>
        </div>
    </div>

    <div id="terminal" class="term-overlay">
        <div class="term-header">
            <span><i class="fas fa-terminal"></i> TERMINAL (Python Sandbox)</span>
            <i class="fas fa-chevron-down" style="cursor: pointer;" onclick="toggleTerminal()"></i>
        </div>
        <div class="term-body" id="termOutput">
            <div class="term-line" style="color: #666;">EuroShell v2.0.0 - Ready. Type 'help' or python code.</div>
        </div>
        <div class="term-input-line" style="padding: 10px 20px;">
            <span class="term-prompt">âžœ</span>
            <input type="text" class="term-in" id="termInput" autocomplete="off">
        </div>
    </div>

    <div id="apiModal" class="modal">
        <div class="modal-card">
            <div class="modal-head">
                <span>API Documentation</span>
                <i class="fas fa-times" style="cursor: pointer;" onclick="toggleModal('api')"></i>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-dim);">Automate your workflow using our secure REST API.</p>
                <div style="margin-bottom: 20px;">
                    <span class="api-method">POST</span> <code style="color: #fff;">{{ request.url_root }}process</code>
                </div>
                
                <h3 style="margin-bottom: 10px; font-size: 14px;">Python Example</h3>
                <pre>import requests

url = "{{ request.url_root }}process"
payload = {
    "code": "print('Hello')",
    "action": "encrypt",
    "lang": "python",
    "options": ["rename", "marshal"]
}

res = requests.post(url, json=payload)
print(res.json()['result'])</pre>
            </div>
        </div>
    </div>

    <div class="shortcuts">Ctrl+Enter: Run | Ctrl+/: Terminal | Ctrl+S: Download</div>

    <script>
        // LOGIC
        let curLang = 'python';
        let curMode = 'encrypt';
        let cmdHistory = [];
        let historyIndex = -1;

        const configs = {
            python: { color: '#6366f1', mode: 'python', opts: [ 
                {id:'rename', l:'Variable Renaming'}, {id:'marshal', l:'Portable Blob'}, 
                {id:'deadcode', l:'Dead Code Injection'}, {id:'nightmare', l:'Nightmare Mode ðŸ’€'},
                {id:'xor', l:'XOR Encryption'}
            ]},
            javascript: { color: '#eab308', mode: 'javascript', opts: [{id:'hex', l:'Hex Encoding'}, {id:'url', l:'URL Encode'}, {id:'base64', l:'Base64'}] },
            lua: { color: '#22c55e', mode: 'lua', opts: [{id:'hex', l:'Hex Loader'}, {id:'reverse', l:'String Reverse'}] },
            php: { color: '#8b5cf6', mode: 'php', opts: [{id:'base64', l:'Gzip + Base64'}] },
            html: { color: '#f97316', mode: 'htmlmixed', opts: [{id:'hex', l:'Hex JS Write'}] }
        };

        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            mode: "python", theme: "ayu-mirage", lineNumbers: true, lineWrapping: true
        });

        function setLang(l, c) {
            curLang = l;
            document.documentElement.style.setProperty('--accent', c);
            editor.setOption("mode", configs[l].mode);
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            renderOpts();
        }
        
        function renderOpts() {
            const c = document.getElementById('dynamic-opts'); c.innerHTML = '';
            configs[curLang].opts.forEach(o => {
                c.innerHTML += `
                    <label class="opt-card">
                        <span class="opt-label"><i class="fas fa-layer-group" style="color:var(--accent)"></i> ${o.l}</span>
                        <input type="checkbox" class="opt-checkbox" id="opt-${o.id}" checked>
                    </label>`;
            });
        }
        setLang('python', '#6366f1');

        function setMode(m) {
            curMode = m;
            document.getElementById('enc-opts').style.display = m==='encrypt'?'block':'none';
            document.getElementById('dec-opts').style.display = m==='encrypt'?'none':'block';
            document.querySelectorAll('.switch-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('actionBtn').innerText = m==='encrypt'?'PROTECT CODE':'DECRYPT CODE';
        }

        async function process() {
            const code = editor.getValue(); if(!code.trim()) return alert("No Code!");
            let opts = []; 
            if(curMode==='encrypt') document.querySelectorAll('.opt-checkbox:checked').forEach(c=>opts.push(c.id.replace('opt-','')));
            
            const btn = document.getElementById('actionBtn');
            const oldText = btn.innerText;
            btn.innerText = 'PROCESSING...';
            
            try {
                const res = await fetch('/process', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code, action:curMode, lang:curLang, options:opts}) });
                const d = await res.json();
                editor.setValue(d.result);
            } catch { alert("Error"); }
            finally { btn.innerText = oldText; }
        }

        // Shortcuts
        document.addEventListener('keydown', e => {
            if (e.ctrlKey && e.key === 'Enter') process();
            if (e.ctrlKey && e.key === '/') toggleTerminal();
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); download(); }
        });

        // Terminal Logic
        function toggleTerminal() {
            const t = document.getElementById('terminal');
            t.classList.toggle('open');
            if(t.classList.contains('open')) document.getElementById('termInput').focus();
        }

        const termOut = document.getElementById('termOutput');
        const termIn = document.getElementById('termInput');

        termIn.addEventListener('keydown', async e => {
            if (e.key === 'Enter') {
                const cmd = termIn.value; 
                if(!cmd) return;
                
                cmdHistory.push(cmd); historyIndex = cmdHistory.length;
                termIn.value = '';
                
                termOut.innerHTML += `<div class="term-line"><span style="color:var(--accent)">âžœ</span> ${cmd}</div>`;
                
                if (cmd === 'clear') { termOut.innerHTML = ''; return; }
                
                try {
                    const res = await fetch('/run', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code: cmd}) });
                    const d = await res.json();
                    termOut.innerHTML += `<div class="term-line" style="color:#ccc">${d.output}</div>`;
                } catch {
                    termOut.innerHTML += `<div class="term-line" style="color:#f44747">Connection Error</div>`;
                }
                termOut.scrollTop = termOut.scrollHeight;
            }
            // History navigation
            if (e.key === 'ArrowUp') {
                if (historyIndex > 0) { historyIndex--; termIn.value = cmdHistory[historyIndex]; }
            }
            if (e.key === 'ArrowDown') {
                if (historyIndex < cmdHistory.length - 1) { historyIndex++; termIn.value = cmdHistory[historyIndex]; }
                else { historyIndex = cmdHistory.length; termIn.value = ''; }
            }
        });

        // Utils
        function toggleModal(id) {
            const m = document.getElementById(id+'Modal');
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        }
        function copy() { navigator.clipboard.writeText(editor.getValue()); alert("Copied!"); }
        function download() {
            const b = new Blob([editor.getValue()], {type:'text/plain'});
            const u = URL.createObjectURL(b);
            const a = document.createElement('a'); a.href=u; a.download='Result.txt'; a.click();
        }
    </script>
</body>
</html>
