<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroMoscow | V25 Professional</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>

    <style>
        /* V25 MODERN THEME */
        :root {
            --bg: #050505; --surface: #0f0f12; --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --primary: #3b82f6; --text: #e4e4e7; --text-dim: #a1a1aa;
        }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; background-image: linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px); background-size: 40px 40px; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; } ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Navbar */
        nav { height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: 1px solid var(--border); background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(15px); z-index: 100; }
        .brand { font-size: 20px; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 12px; letter-spacing: -0.5px; } .brand i { color: var(--primary); filter: drop-shadow(0 0 10px var(--primary)); }
        .tabs-container { display: flex; gap: 5px; background: rgba(255, 255, 255, 0.03); padding: 4px; border-radius: 10px; border: 1px solid var(--border); }
        .tab { padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-dim); transition: 0.3s; }
        .tab:hover { color: #fff; background: rgba(255,255,255,0.05); } .tab.active { background: var(--primary); color: #000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .extra-link { cursor:pointer; color:#ccc; font-weight:600; font-size:13px; margin-left:15px; display:flex; align-items:center; gap:5px; } .extra-link:hover { color:#fff; }

        /* Sidebar */
        .layout { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 360px; background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; }
        .sidebar-footer { padding: 25px; border-top: 1px solid var(--border); background: rgba(0,0,0,0.2); }

        /* Controls */
        .mode-switch { display: flex; background: #000; border-radius: 8px; padding: 4px; border: 1px solid var(--border); }
        .mode-btn { flex: 1; padding: 10px; text-align: center; cursor: pointer; border-radius: 6px; font-weight: 700; font-size: 12px; color: var(--text-dim); transition: 0.3s; }
        .mode-btn.active { background: rgba(255, 255, 255, 0.05); color: #fff; border: 1px solid var(--border); }
        .mode-btn.active.enc { color: var(--primary); border-color: var(--primary); } .mode-btn.active.dec { color: #ff4d4d; border-color: #ff4d4d; }

        .toggle-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: 0.2s; }
        .toggle-item:hover { border-color: var(--primary); background: rgba(255,255,255,0.05); }
        .toggle-switch { width: 36px; height: 20px; background: #333; border-radius: 20px; position: relative; transition: 0.3s; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: #fff; border-radius: 50%; transition: 0.3s; }
        input[type="checkbox"] { display: none; } input:checked + .toggle-switch { background: var(--primary); } input:checked + .toggle-switch::after { transform: translateX(16px); }
        
        .btn-main { width: 100%; padding: 16px; border-radius: 12px; border: none; background: var(--primary); color: #000; font-weight: 800; font-size: 15px; cursor: pointer; transition: 0.3s; letter-spacing: 0.5px; box-shadow: 0 10px 30px -10px var(--primary); }
        .btn-main:hover { transform: translateY(-2px); }
        .btn-scan { width: 100%; background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; border-radius: 10px; transition: 0.3s; }
        .btn-scan:hover { background: rgba(255,255,255,0.05); box-shadow: 0 0 20px var(--primary); }

        /* Editor */
        .editor-wrapper { flex: 1; display: flex; flex-direction: column; background: #0b0b0e; position: relative; }
        .editor-header { height: 50px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; background: rgba(255, 255, 255, 0.03); }
        .CodeMirror { flex: 1; font-family: 'JetBrains Mono'; font-size: 14px; background: transparent !important; } .cm-s-dracula.CodeMirror { background: transparent !important; }

        /* Overlays */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 900; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .win { width: 80%; height: 80%; background: #0a0a0a; border: 1px solid var(--primary); border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 0 50px rgba(0,0,0,0.5); overflow: hidden; }
        .win-head { padding: 15px 25px; background: #111; border-bottom: 1px solid var(--primary); display: flex; justify-content: space-between; align-items: center; font-weight: bold; color: var(--primary); font-size: 18px; }
        .win-body { flex: 1; padding: 25px; overflow-y: auto; color: #ccc; }
        
        /* Terminal */
        .term-body { background: #000; color: #0f0; font-family: 'VT323', monospace; font-size: 20px; padding: 20px; flex: 1; overflow-y: auto; }
        .term-input { padding: 15px; border-top: 1px solid #333; background: #050505; display: flex; font-family: 'VT323'; font-size: 20px; color: #0f0; }
        .term-in-field { flex: 1; background: transparent; border: none; color: #fff; font-family: inherit; font-size: inherit; outline: none; }

        /* Docs */
        .docs-body pre { background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; color: #00ff88; font-family: 'JetBrains Mono'; font-size: 13px; overflow-x: auto; }

        /* AI Chat */
        .ai-widget { position: fixed; bottom: 30px; right: 30px; z-index: 200; }
        .ai-bubble { width: 65px; height: 65px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #000; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ai-window { position: absolute; bottom: 80px; right: 0; width: 360px; height: 500px; background: rgba(15, 15, 20, 0.98); border: 1px solid var(--primary); border-radius: 12px; display: none; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); }
        .ai-msgs { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-family: 'JetBrains Mono'; font-size: 12px; color: #ccc; }
        .msg { padding: 10px; border-radius: 8px; max-width: 85%; } .msg.bot { background: #222; border-left: 2px solid var(--primary); align-self: flex-start; } .msg.user { background: var(--primary); color: #000; align-self: flex-end; font-weight: bold; }
        .ai-input { padding: 10px; border-top: 1px solid #333; display: flex; gap: 5px; background: #000; } .ai-input input { flex: 1; background: transparent; border: none; color: #fff; padding: 8px; outline: none; }

        .loader-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 50; }
        .spinner { border: 4px solid #333; border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 900px) { .layout { flex-direction: column; } .sidebar { width: 100%; order: 2; border-right: none; border-top: 1px solid var(--primary); height: auto; } .editor-wrapper { height: 500px; order: 1; } .tabs-container { display: none; } }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fas fa-shield-cat"></i> EuroMoscow <small style="margin-left:5px; opacity:0.5;">V25</small></div>
        <div class="tabs-container">
            <div class="tab active" onclick="setLang('python', '#3b82f6')">Python</div>
            <div class="tab" onclick="setLang('javascript', '#facc15')">JavaScript</div>
            <div class="tab" onclick="setLang('lua', '#22c55e')">Lua</div>
            <div class="tab" onclick="setLang('php', '#8b5cf6')">PHP</div>
            <div class="tab" onclick="setLang('html', '#f97316')">HTML</div>
        </div>
        <div style="display:flex; gap:15px;">
            <div class="extra-link" onclick="openOverlay('term')"><i class="fas fa-terminal"></i> Term</div>
            <div class="extra-link" onclick="openOverlay('docs')"><i class="fas fa-book"></i> API</div>
        </div>
    </nav>

    <div class="layout">
        <div class="sidebar">
            <div style="padding: 20px; border-bottom: 1px solid var(--border);">
                <div class="mode-switch">
                    <div class="mode-btn active enc" onclick="setMode('encrypt')">ENCRYPT</div>
                    <div class="mode-btn" onclick="setMode('decrypt')">DECRYPT</div>
                </div>
            </div>

            <div class="sidebar-content">
                <div id="encPanel">
                    <button class="btn-scan" onclick="analyze()"><i class="fas fa-microchip"></i> AI SECURITY SCAN</button>
                    <div style="margin-top:20px; font-size:11px; font-weight:800; color:#666; margin-bottom:10px;">LAYERS</div>
                    <div id="opts-container"></div>
                    <div style="margin-top:20px; font-size:11px; font-weight:800; color:#666; margin-bottom:10px;">FILES</div>
                    <button class="toggle-item" onclick="document.getElementById('file').click()" style="justify-content: center; color: #aaa;">Upload File</button>
                    <input type="file" id="file" style="display: none;">
                    <button class="toggle-item" onclick="document.getElementById('zip').click()" style="justify-content: center; color: #aaa;">Upload Project ZIP</button>
                    <input type="file" id="zip" style="display: none;" accept=".zip">
                </div>
                <div id="decPanel" style="display: none; text-align: center; padding: 20px;">
                    <i class="fas fa-robot" style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"></i>
                    <p style="color:#888; font-size:13px;">EuroMind AI will automatically detect encryption.</p>
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="btn-main" onclick="process()">PROTECT CODE</button>
                <button class="btn-main" style="background: transparent; border: 1px solid var(--border); margin-top: 10px; color: var(--text-dim);" onclick="download()">Download File</button>
            </div>
        </div>

        <div class="editor-wrapper">
            <div class="editor-header">
                <span style="font-weight:700; font-size:12px; color:#888;" id="langLabel">PYTHON SOURCE</span>
                <div style="display:flex; gap:10px;">
                    <i class="fas fa-eraser" style="cursor:pointer; color:#666;" onclick="editor.setValue('')"></i>
                    <i class="fas fa-copy" style="cursor:pointer; color:#666;" onclick="copy()"></i>
                </div>
            </div>
            <textarea id="editor"></textarea>
        </div>
    </div>

    <div id="termOverlay" class="overlay">
        <div class="win">
            <div class="win-head" style="border-color:#0f0; color:#0f0;"><span>TERMINAL</span> <i class="fas fa-times close-btn" onclick="closeOverlay('term')"></i></div>
            <div class="term-body" id="termOut">EuroShield Terminal v25... Ready.<br>Type python code to execute.</div>
            <div class="term-in"><span style="color:#0f0; margin-right:10px;">$</span> <input type="text" class="term-in-field" id="termIn" autofocus></div>
        </div>
    </div>

    <div id="docsOverlay" class="overlay">
        <div class="win">
            <div class="win-head"><span>API DOCS</span> <i class="fas fa-times close-btn" onclick="closeOverlay('docs')"></i></div>
            <div class="win-body docs-body">
                <h2>POST /process</h2>
                <p style="color:#888; margin-bottom:10px;">Send JSON to encrypt/decrypt.</p>
                <pre>
import requests
res = requests.post("{{ request.url_root }}process", json={
    "code": "print('Hi')", "action": "encrypt", "lang": "python"
})
print(res.json()['result'])</pre>
            </div>
        </div>
    </div>

    <div class="ai-widget">
        <div class="ai-window" id="aiWindow">
            <div class="ai-header">EuroMind AI <i class="fas fa-times" style="cursor:pointer;" onclick="toggleAi()"></i></div>
            <div class="ai-msgs" id="aiMsgs"><div class="msg bot">Hello! I am EuroMind. Ask me anything.</div></div>
            <div class="ai-input"><input type="text" id="aiIn" placeholder="Ask..."><i class="fas fa-paper-plane" style="color:var(--primary); cursor:pointer;" onclick="sendAi()"></i></div>
        </div>
        <div class="ai-bubble" onclick="toggleAi()"><i class="fas fa-comment-dots"></i></div>
    </div>

    <div class="loader-overlay" id="loader"><div class="spinner"></div></div>
    <footer>&copy; 2025 EuroMoscow.</footer>

    <script>
        let curLang='python', curMode='encrypt';
        const UI = {
            python: { color: '#3b82f6', mode: 'python', opts: [{id:'rename', l:'Renaming'}, {id:'marshal', l:'Portable Blob'}, {id:'deadcode', l:'Dead Code'}, {id:'xor', l:'XOR Encryption'}, {id:'zlib', l:'Zlib'}] },
            javascript: { color: '#facc15', mode: 'javascript', opts: [{id:'hex', l:'Hex Encoding'}, {id:'url', l:'URL Encode'}, {id:'base64', l:'Base64 Eval'}] },
            lua: { color: '#22c55e', mode: 'lua', opts: [{id:'byte', l:'Bytecode'}, {id:'hex', l:'Hex Loader'}, {id:'reverse', l:'String Reversal'}] },
            php: { color: '#8b5cf6', mode: 'php', opts: [{id:'base64', l:'Gzip Base64'}] },
            html: { color: '#f97316', mode: 'htmlmixed', opts: [{id:'hex', l:'Hex Write'}] }
        };

        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), { mode: "python", theme: "dracula", lineNumbers: true });

        function setLang(l, c) {
            curLang = l; document.documentElement.style.setProperty('--primary', c);
            document.getElementById('langLabel').innerText = l.toUpperCase() + " SOURCE";
            editor.setOption("mode", UI[l].mode);
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            const con = document.getElementById('opts-container'); con.innerHTML = '';
            UI[l].opts.forEach(o => {
                con.innerHTML += `<label class="toggle-item"><span class="opt-lbl">${o.l}</span><input type="checkbox" id="opt-${o.id}" checked><div class="toggle-switch"></div></label>`;
            });
        }
        setLang('python', '#3b82f6');

        function setMode(m) {
            curMode = m;
            const btn = document.querySelector('.btn-main');
            if(m === 'encrypt') {
                document.getElementById('encPanel').style.display='block';
                document.getElementById('decPanel').style.display='none';
                document.querySelector('.mode-btn.enc').classList.add('active', 'enc');
                document.querySelector('.mode-btn.dec').classList.remove('active', 'dec');
                btn.innerText = 'PROTECT CODE';
            } else {
                document.getElementById('encPanel').style.display='none';
                document.getElementById('decPanel').style.display='block';
                document.querySelector('.mode-btn.dec').classList.add('active', 'dec');
                document.querySelector('.mode-btn.enc').classList.remove('active', 'enc');
                btn.innerText = 'DECRYPT CODE';
            }
        }

        async function process() {
            const code = editor.getValue(); if(!code.trim()) return alert("No Code!");
            let opts = []; if(curMode==='encrypt') document.querySelectorAll('input:checked').forEach(c=>opts.push(c.id.replace('opt-','')));
            document.getElementById('loader').style.display='flex';
            try {
                const res = await fetch('/process', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code, action:curMode, lang:curLang, options:opts}) });
                const d = await res.json(); editor.setValue(d.result);
            } catch { alert("Error"); } finally { document.getElementById('loader').style.display='none'; }
        }

        function download() {
            const blob = new Blob([editor.getValue()], {type:'text/plain'});
            const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download=`Protected.${curLang==='python'?'py':'js'}`; a.click();
        }

        function openOverlay(id) { document.getElementById(id+'Overlay').style.display='flex'; }
        function closeOverlay(id) { document.getElementById(id+'Overlay').style.display='none'; }
        function toggleAi() { const w=document.getElementById('aiWindow'); w.style.display=w.style.display==='flex'?'none':'flex'; }
        
        async function sendAi() {
            const i=document.getElementById('aiIn'); const t=i.value; if(!t)return;
            document.getElementById('aiMsgs').innerHTML+=`<div class="msg user">${t}</div>`; i.value='';
            const res=await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:t, code:editor.getValue()})});
            const d=await res.json(); document.getElementById('aiMsgs').innerHTML+=`<div class="msg bot">${d.reply}</div>`;
        }
        document.getElementById('aiIn').addEventListener('keypress', e=>{if(e.key==='Enter')sendAi()});
        async function analyze() {
            const res=await fetch('/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code:editor.getValue(), lang:curLang})});
            const d=await res.json(); toggleAi(); document.getElementById('aiMsgs').innerHTML+=`<div class="msg bot">${d.reply}</div>`;
        }

        const termOut = document.getElementById('termOut');
        document.getElementById('termIn').addEventListener('keypress', async e=>{
            if(e.key==='Enter') {
                const cmd = e.target.value; e.target.value=''; termOut.innerHTML+=`\n<span style="color:var(--primary)">$</span> ${cmd}`;
                if(cmd==='clear') termOut.innerHTML=''; else if(cmd==='exit') closeOverlay('term');
                else {
                    try { const r=await fetch('/run', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code:cmd})});
                    const d=await r.json(); termOut.innerHTML+=`\n${d.output}`; } catch { termOut.innerHTML+='\nError'; }
                }
                termOut.scrollTop=termOut.scrollHeight;
            }
        });
        
        document.getElementById('file').addEventListener('change', e => { const f=e.target.files[0]; if(f){ const r=new FileReader(); r.onload=ev=>editor.setValue(ev.target.result); r.readAsText(f); } });
        document.getElementById('zip').addEventListener('change', async e => { 
            const f=e.target.files[0]; if(!f)return;
            const fd=new FormData(); fd.append('file', f); fd.append('options', 'rename');
            try { const res=await fetch('/upload-zip', {method:'POST', body:fd}); const b=await res.blob(); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='Project_Encrypted.zip'; a.click(); alert('Done!'); } catch{ alert('Error'); }
        });
        function copy() { navigator.clipboard.writeText(editor.getValue()); alert("Copied!"); }
    </script>
</body>
</html>
