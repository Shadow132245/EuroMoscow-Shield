<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EuroMoscow | V25 Ultimate</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@600;700;800&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <style>
        /* ORIGINAL DESIGN VARIABLES */
        :root { --bg-core: #050505; --bg-panel: #111111; --border: #222; --primary: #00e1ff; --text: #eeeeee; }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; background: var(--bg-core); color: var(--text); font-family: 'Rajdhani', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        ::-webkit-scrollbar { width: 6px; } 
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; } 
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        /* Navbar (Old Style - 8 Buttons) */
        nav { height: 75px; background: rgba(10,10,10,0.98); border-bottom: 2px solid var(--primary); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; }
        .brand { font-size: 24px; font-weight: 800; color: #fff; display: flex; gap: 10px; align-items: center; } 
        .brand span { color: var(--primary); text-shadow: 0 0 15px var(--primary); }
        .nav-items { display: flex; gap: 5px; }
        .nav-btn { background: transparent; border: 1px solid var(--border); color: #888; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-family: 'Rajdhani'; font-weight: 700; font-size: 12px; transition: 0.3s; display: flex; align-items: center; gap: 5px; }
        .nav-btn:hover { color: #fff; border-color: #444; background: rgba(255,255,255,0.05); }
        .nav-btn.active { border-color: var(--primary); color: var(--primary); }
        .sep { color: #333; font-size: 18px; margin: 0 2px; display: flex; align-items: center; }
        
        @media (max-width: 900px) { .nav-btn span { display: none; } nav { padding: 0 10px; } }

        /* Workspace */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 340px; background: var(--bg-panel); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; flex-shrink: 0; z-index: 5; }
        
        .editor-container { flex: 1; display: flex; flex-direction: column; border-right: 1px solid #333; position: relative; min-width: 0; }
        .editor-toolbar { height: 45px; background: #151515; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid #333; font-size: 12px; font-weight: 700; color: #666; }
        .CodeMirror { flex: 1; font-family: 'JetBrains Mono'; font-size: 14px; height: auto !important; }

        /* Controls (Old Style) */
        .section-title { color: var(--primary); font-weight: 800; font-size: 13px; margin: 10px 0; letter-spacing: 1px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .checkbox-wrapper { display: flex; gap: 10px; align-items: center; padding: 10px; background: #1a1a1a; margin-bottom: 5px; border-radius: 4px; cursor: pointer; border: 1px solid #333; transition: 0.2s; }
        .checkbox-wrapper:hover { border-color: var(--primary); background: #202020; }
        input[type="checkbox"] { accent-color: var(--primary); transform: scale(1.2); }
        
        .btn { padding: 12px; width: 100%; background: var(--primary); color: #000; border: none; border-radius: 4px; font-weight: 800; font-size: 16px; cursor: pointer; margin-top: 10px; transition: 0.3s; text-transform: uppercase; }
        .btn:hover { box-shadow: 0 0 20px var(--primary); filter: brightness(1.1); }
        .btn-dl { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-dl:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .btn-scan { background: rgba(255,255,255,0.05); border: 1px solid var(--primary); color: var(--primary); display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }

        /* Overlays (Terminal & Docs) */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 999; display: none; flex-direction: column; backdrop-filter: blur(5px); }
        .overlay-header { height: 60px; border-bottom: 1px solid var(--primary); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; font-weight: bold; color: var(--primary); font-size: 20px; background: #111; }
        .overlay-body { flex: 1; padding: 30px; overflow-y: auto; font-family: 'JetBrains Mono'; color: #ccc; white-space: pre-wrap; }
        .close-btn { cursor: pointer; color: #f00; border: 1px solid #f00; padding: 5px 15px; font-size: 12px; border-radius: 4px; }
        
        /* Terminal */
        .term-body { background: #000; color: #0f0; font-family: 'VT323'; font-size: 22px; padding: 20px; flex: 1; overflow-y: auto; }
        .term-input-area { display: flex; border-top: 1px solid #333; padding: 15px; background: #000; font-family: 'VT323'; font-size: 22px; }
        .term-prompt { color: #0f0; margin-right: 10px; }
        .term-input { flex: 1; background: transparent; border: none; color: #fff; font-family: inherit; font-size: inherit; outline: none; }

        /* AI Chat Widget */
        .ai-widget { position: fixed; bottom: 20px; right: 20px; z-index: 200; }
        .ai-bubble { width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; color: #000; cursor: pointer; box-shadow: 0 0 20px var(--primary); }
        .ai-window { position: absolute; bottom: 80px; right: 0; width: 320px; height: 400px; background: #111; border: 1px solid var(--primary); border-radius: 8px; display: none; flex-direction: column; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .ai-header { padding: 10px; background: rgba(255,255,255,0.05); font-weight: 800; color: var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .ai-msgs { flex: 1; padding: 10px; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 12px; color: #ccc; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 8px 12px; border-radius: 4px; max-width: 90%; }
        .msg.bot { background: #222; border-left: 2px solid var(--primary); align-self: flex-start; }
        .msg.user { background: rgba(255,255,255,0.1); align-self: flex-end; text-align: right; }
        .ai-input { padding: 10px; border-top: 1px solid #333; display: flex; gap: 5px; background: #000; }
        .ai-input input { flex: 1; background: transparent; border: 1px solid #333; color: #fff; padding: 8px; outline: none; }

        .loader-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 50; }
        .spinner { border:4px solid #333; border-top:4px solid var(--primary); border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        footer { height: 30px; background: #080808; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #444; border-top: 1px solid #222; }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fas fa-shield-virus"></i> EURO<span>SHIELD</span></div>
        <div class="nav-items">
            <button class="nav-btn active" onclick="setMode('python', 'encrypt')"><i class="fab fa-python"></i> PY ENC</button>
            <button class="nav-btn" onclick="setMode('python', 'decrypt')"><i class="fas fa-unlock"></i> PY DEC</button>
            <span class="sep">|</span>
            <button class="nav-btn" onclick="setMode('javascript', 'encrypt')"><i class="fab fa-js"></i> JS ENC</button>
            <button class="nav-btn" onclick="setMode('javascript', 'decrypt')"><i class="fas fa-unlock-alt"></i> JS DEC</button>
            <span class="sep">|</span>
            <button class="nav-btn" onclick="setMode('lua', 'encrypt')"><i class="fas fa-gamepad"></i> LUA ENC</button>
            <button class="nav-btn" onclick="setMode('lua', 'decrypt')"><i class="fas fa-key"></i> LUA DEC</button>
            <span class="sep">|</span>
            <button class="nav-btn" style="border-color:#0f0; color:#0f0;" onclick="openOverlay('term')"><i class="fas fa-terminal"></i> TERM</button>
            <button class="nav-btn" style="border-color:#fff; color:#fff;" onclick="openOverlay('docs')"><i class="fas fa-book"></i> API</button>
        </div>
    </nav>

    <div class="workspace">
        <div class="sidebar">
            <div id="enc-panel">
                <button class="btn btn-scan" onclick="analyze()"><i class="fas fa-microchip"></i> AI SECURITY SCAN</button>
                <div class="section-title">LAYERS</div>
                <div id="opts-container"></div>
                <div class="section-title" style="margin-top:20px;">FILES</div>
                <button class="btn-file btn-dl" style="width:100%; margin-top:0;" onclick="document.getElementById('fileInput').click()">Upload File</button>
                <input type="file" id="fileInput" style="display:none">
                <button class="btn" onclick="process()">ENCRYPT CODE</button>
            </div>
            
            <div id="dec-panel" style="display:none;">
                <div class="section-title">DECRYPT CONSOLE</div>
                <div class="log-panel" id="logPanel" style="height:200px; overflow:auto; background:#151515; padding:10px; border:1px solid #333; color:#aaa; font-family:'JetBrains Mono'; font-size:11px;">[SYS] Ready...</div>
                <button class="btn" onclick="process()">START DECRYPTION</button>
            </div>

            <button class="btn-dl" onclick="downloadResult()" style="margin-top:10px; width:100%;">DOWNLOAD RESULT</button>
        </div>

        <div class="editor-container">
            <div class="editor-toolbar"><span id="langLabel">PYTHON SOURCE</span> <i class="fas fa-eraser" onclick="editor.setValue('')" style="cursor:pointer; color:#666;"></i></div>
            <textarea id="editor"></textarea>
        </div>
        <div class="editor-container" style="border-left:1px solid #333;">
            <div class="editor-toolbar"><span style="color:var(--primary)">OUTPUT</span> <i class="fas fa-copy" onclick="copy()" style="cursor:pointer; color:var(--primary);"></i></div>
            <textarea id="out"></textarea>
        </div>
    </div>

    <div id="term-overlay" class="overlay">
        <div class="overlay-header" style="color:#0f0; border-color:#0f0;"><span>TERMINAL</span> <span class="close-btn" onclick="closeOverlay('term')">CLOSE</span></div>
        <div class="term-body" id="termOut">EuroShield Terminal v25... Ready.<br>Type python code to execute.</div>
        <div class="term-input-area"><span class="term-prompt">$</span> <input type="text" class="term-input" id="termIn" autofocus></div>
    </div>

    <div id="docs-overlay" class="overlay">
        <div class="overlay-header"><span>API DOCS</span> <span class="close-btn" onclick="closeOverlay('docs')">CLOSE</span></div>
        <div class="overlay-body" style="padding:30px; color:#ccc;">
            <h2>POST /process</h2>
            <pre style="background:#111; padding:15px; border:1px solid #333;">import requests; res=requests.post("{{ request.url_root }}process", json={"code":"print('Hi')","action":"encrypt","lang":"python"})</pre>
        </div>
    </div>

    <div class="ai-widget">
        <div class="ai-window" id="aiWindow">
            <div class="ai-header">EuroMind AI <i class="fas fa-times" style="cursor:pointer" onclick="toggleAi()"></i></div>
            <div class="ai-msgs" id="aiMsgs"><div class="msg bot">Hello! Paste code to analyze.</div></div>
            <div class="ai-input"><input type="text" id="aiIn" placeholder="Ask..."><i class="fas fa-paper-plane" style="color:var(--primary); cursor:pointer;" onclick="sendAi()"></i></div>
        </div>
        <div class="ai-bubble" onclick="toggleAi()"><i class="fas fa-comment-dots"></i></div>
    </div>

    <div class="loader-overlay" id="loader"><div class="spinner"></div></div>
    <footer>&copy; 2025 EuroMoscow.</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/lua/lua.min.js"></script>

    <script>
        let curLang='python', curAction='encrypt';
        const UI = {
            python: { color:'#00e1ff', mode:'python', opts:[{id:'rename', l:'Renaming'},{id:'marshal', l:'Portable Blob'},{id:'xor', l:'XOR'},{id:'zlib', l:'Zlib'}] },
            javascript: { color:'#facc15', mode:'javascript', opts:[{id:'hex', l:'Hex'},{id:'url', l:'URL'},{id:'base64', l:'Base64'}] },
            lua: { color:'#00ff88', mode:'lua', opts:[{id:'byte', l:'Bytecode'},{id:'hex', l:'Hex'},{id:'reverse', l:'Reverse'}] }
        };

        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), { mode: "python", theme: "dracula", lineNumbers: true });
        var out = CodeMirror.fromTextArea(document.getElementById("out"), { mode: "python", theme: "dracula", lineNumbers: true, readOnly: true });

        function setMode(lang, action) {
            curLang = lang; curAction = action;
            document.documentElement.style.setProperty('--primary', UI[lang].color);
            document.getElementById('langLabel').innerText = lang.toUpperCase();
            editor.setOption("mode", UI[lang].mode);
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            if(action === 'encrypt') {
                document.getElementById('enc-panel').style.display='block';
                document.getElementById('dec-panel').style.display='none';
                const c = document.getElementById('opts-container'); c.innerHTML='';
                UI[lang].opts.forEach(o=>{ c.innerHTML+=`<label class="checkbox-wrapper"><input type="checkbox" id="opt-${o.id}" checked> ${o.l}</label>`; });
            } else {
                document.getElementById('enc-panel').style.display='none';
                document.getElementById('dec-panel').style.display='block';
            }
        }
        
        // Init
        setMode('python', 'encrypt');

        async function process() {
            const code = editor.getValue(); if(!code.trim()) return alert("No Code!");
            let opts = []; if(curAction==='encrypt') document.querySelectorAll('input:checked').forEach(c=>opts.push(c.id.replace('opt-','')));
            document.getElementById('loader').style.display='flex';
            try {
                const res = await fetch('/process', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code, action:curAction, lang:curLang, options:opts}) });
                const d = await res.json(); out.setValue(d.result);
                if(curAction==='decrypt') document.getElementById('logPanel').innerHTML+=`<div class="log-entry" style="color:#0f0">> Done.</div>`;
            } catch { alert("Error"); } finally { document.getElementById('loader').style.display='none'; }
        }

        function downloadResult() { const b=new Blob([out.getValue()],{type:'text/plain'}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='Protected.txt'; a.click(); }
        
        // Overlays
        function openOverlay(id) { document.getElementById(id+'-overlay').style.display='flex'; }
        function closeOverlay(id) { document.getElementById(id+'-overlay').style.display='none'; }

        // Terminal
        const tOut = document.getElementById('termOut');
        document.getElementById('termIn').addEventListener('keypress', async e=>{
            if(e.key==='Enter') {
                const c=e.target.value; e.target.value=''; tOut.innerHTML+=`\n$ ${c}`;
                if(c==='clear') tOut.innerHTML=''; else if(c==='exit') closeOverlay('term');
                else {
                    try { const r=await fetch('/run', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({code:c, lang:curLang})});
                    const d=await r.json(); tOut.innerHTML+=`\n${d.output}`; } catch { tOut.innerHTML+='\nError'; }
                }
                tOut.scrollTop=tOut.scrollHeight;
            }
        });

        // AI
        function toggleAi() { const w=document.getElementById('aiWindow'); w.style.display=w.style.display==='flex'?'none':'flex'; }
        async function sendAi() {
            const i=document.getElementById('aiIn'); const t=i.value; if(!t)return;
            document.getElementById('aiMsgs').innerHTML+=`<div class="msg user">${t}</div>`; i.value='';
            const res=await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:t, code:editor.getValue()})});
            const d=await res.json(); document.getElementById('aiMsgs').innerHTML+=`<div class="msg bot">${d.reply}</div>`;
        }
        document.getElementById('aiInput').addEventListener('keypress', e=>{if(e.key==='Enter')sendAi()});
        async function analyze() {
            const res=await fetch('/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code:editor.getValue()})});
            const d=await res.json(); toggleAi(); document.getElementById('aiMsgs').innerHTML+=`<div class="msg bot">${d.msg}</div>`;
        }
        
        document.getElementById('fileInput').addEventListener('change', e => { const f=e.target.files[0]; if(f){ const r=new FileReader(); r.onload=ev=>editor.setValue(ev.target.result); r.readAsText(f); } });
        function copy() { navigator.clipboard.writeText(out.getValue()); alert("Copied!"); }
    </script>
</body>
</html>
