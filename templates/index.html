<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroMoscow Shield | V13</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/lua/lua.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>

    <style>
        :root {
            --bg: #050505;
            --panel: #111111;
            --primary: #00e1ff; /* Default Blue */
            --text: #eeeeee;
            --border: #222;
        }

        * { box-sizing: border-box; outline: none; }
        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Rajdhani', sans-serif; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* Navbar */
        nav {
            height: 75px; background: rgba(10, 10, 10, 0.98); border-bottom: 2px solid var(--primary);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; z-index: 100; flex-shrink: 0;
        }
        .brand { font-size: 26px; font-weight: 800; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--primary); text-shadow: 0 0 15px var(--primary); }
        
        .nav-btn {
            text-decoration: none; color: #888; font-weight: 700; font-size: 13px;
            padding: 8px 15px; border: 1px solid var(--border); border-radius: 4px;
            transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .nav-btn:hover, .nav-btn.active { border-color: var(--primary); color: var(--primary); background: rgba(255, 255, 255, 0.05); }

        /* Language Bar */
        .lang-bar {
            display: flex; gap: 10px; padding: 15px 30px; background: #080808;
            border-bottom: 1px solid var(--border); overflow-x: auto;
        }
        .lang-opt {
            background: #161616; border: 1px solid var(--border); color: #888;
            padding: 8px 20px; border-radius: 4px; cursor: pointer;
            font-weight: 700; font-size: 14px; min-width: 100px; text-align: center;
            transition: 0.3s;
        }
        .lang-opt:hover, .lang-opt.active { border-color: var(--primary); color: #fff; background: var(--primary); color: #000; }

        /* Workspace */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        
        /* Editor Area */
        .editor-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        .editor-container { flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--border); min-width: 0; }
        .CodeMirror { flex: 1; font-family: 'JetBrains Mono'; font-size: 14px; height: auto !important; }

        /* Sidebar */
        .sidebar {
            width: 320px; background: var(--panel); border-left: 1px solid var(--border);
            padding: 25px; display: flex; flex-direction: column; gap: 20px;
        }

        .panel-title { font-size: 12px; color: #666; font-weight: 800; letter-spacing: 1px; margin-bottom: 10px; text-transform: uppercase; }
        
        /* Presets */
        .presets { display: flex; gap: 5px; }
        .preset-btn {
            flex: 1; padding: 10px; border: 1px solid var(--border);
            background: #161616; color: #666; border-radius: 4px;
            cursor: pointer; font-weight: 700; transition: 0.3s;
        }
        .preset-btn:hover, .preset-btn.active { border-color: var(--primary); color: var(--primary); }

        /* Action Button */
        .btn-action {
            padding: 15px; width: 100%; background: var(--primary); color: #000;
            border: none; border-radius: 6px; font-weight: 800; font-size: 18px;
            cursor: pointer; transition: 0.3s; letter-spacing: 1px; margin-top: auto;
        }
        .btn-action:hover { box-shadow: 0 0 20px var(--primary); }

        /* Responsive */
        @media (max-width: 900px) {
            .workspace { flex-direction: column; }
            .sidebar { width: 100%; height: auto; order: 2; border-left: none; border-top: 2px solid var(--primary); }
            .editor-area { height: 500px; order: 1; }
            nav { padding: 10px; }
            .brand span { display: none; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fas fa-shield-halved"></i> EURO<span>SHIELD</span></div>
        <div style="display:flex; gap:10px;">
            <a href="/docs" class="nav-btn"><i class="fas fa-book"></i> API DOCS</a>
            <a href="https://github.com" target="_blank" class="nav-btn"><i class="fab fa-github"></i> GITHUB</a>
        </div>
    </nav>

    <div class="lang-bar">
        <button class="lang-opt active" onclick="setLang('python', '#00e1ff')">PYTHON</button>
        <button class="lang-opt" onclick="setLang('javascript', '#f7df1e')">JS</button>
        <button class="lang-opt" onclick="setLang('lua', '#00ff88')">LUA</button>
        <button class="lang-opt" onclick="setLang('php', '#8892bf')">PHP</button>
        <button class="lang-opt" onclick="setLang('html', '#e34c26')">HTML</button>
    </div>

    <div class="workspace">
        <div class="editor-area">
            <div class="editor-container">
                <textarea id="editor"></textarea>
            </div>
        </div>

        <div class="sidebar">
            <div>
                <div class="panel-title">SECURITY PRESET</div>
                <div class="presets">
                    <button class="preset-btn" onclick="setPreset('perf', this)">FAST</button>
                    <button class="preset-btn active" onclick="setPreset('balanced', this)">BALANCED</button>
                    <button class="preset-btn" onclick="setPreset('max', this)">MAX</button>
                </div>
                <p style="font-size:11px; color:#555; margin-top:10px;">* Max applies renaming, dead code, and heavy encryption.</p>
            </div>

            <div>
                <div class="panel-title">ACTIONS</div>
                <button class="preset-btn" style="width:100%; margin-bottom:10px;" onclick="copyCode()"><i class="fas fa-copy"></i> COPY CODE</button>
                <button class="preset-btn" style="width:100%;" onclick="downloadCode()"><i class="fas fa-download"></i> DOWNLOAD FILE</button>
            </div>

            <button class="btn-action" onclick="processCode()">
                <i class="fas fa-lock"></i> PROTECT
            </button>
        </div>
    </div>

    <script>
        let currentLang = 'python';
        let currentLevel = 'balanced';
        let themeColor = '#00e1ff';

        // Init Editor
        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            mode: "python",
            theme: "dracula",
            lineNumbers: true,
            lineWrapping: true,
            placeholder: "Paste your code here..."
        });

        // Logic: Switch Language
        function setLang(lang, color) {
            currentLang = lang;
            themeColor = color;
            document.documentElement.style.setProperty('--primary', color);
            
            // Active Button
            document.querySelectorAll('.lang-opt').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Editor Mode
            let mode = lang;
            if(lang === 'html') mode = 'htmlmixed';
            if(lang === 'json') mode = 'javascript';
            editor.setOption("mode", mode);
        }

        // Logic: Preset
        function setPreset(level, btn) {
            currentLevel = level;
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // Logic: Process (Encrypt)
        async function processCode() {
            const code = editor.getValue();
            if(!code.trim()) return alert("Please enter some code!");
            
            const btn = document.querySelector('.btn-action');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> PROCESSING...';
            
            try {
                const res = await fetch('/process', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code, lang: currentLang, level: currentLevel })
                });
                const data = await res.json();
                editor.setValue(data.result);
            } catch(e) {
                alert("Error occurred.");
            } finally {
                btn.innerHTML = originalText;
            }
        }

        // Logic: Download (Client Side)
        function downloadCode() {
            const blob = new Blob([editor.getValue()], {type: "text/plain"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            const extMap = {'python': 'py', 'javascript': 'js', 'lua': 'lua', 'php': 'php', 'html': 'html'};
            a.href = url;
            a.download = `EuroShield_${Date.now()}.${extMap[currentLang]}`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }

        function copyCode() {
            navigator.clipboard.writeText(editor.getValue());
            alert("Copied to clipboard!");
        }
    </script>
</body>
</html>
